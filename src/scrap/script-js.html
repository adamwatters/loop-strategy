<script type="module" nonce="v4eqf3g1oxii04so1bjixm">
  window.accessCodePath =
    "/read/58X3WXBFUJ93XTDU/a95b7ec3-77e0-4ca1-976c-06822d0c8204";
  window.initialScrollPos = 0;

  function scrollDoc(e) {
    window.scrollTo(0, e);
  }
  var scrollToPos = window.initialScrollPos;
  scrollDoc(scrollToPos);
  var mobileCheck = function () {
      let e = !1;
      var n;
      return (
        (n = navigator.userAgent || navigator.vendor || window.opera),
        (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(
          n
        ) ||
          /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(
            n.substr(0, 4)
          )) &&
          (e = !0),
        e
      );
    },
    activePlayingLineId = null,
    activePlayingLineOffset = 0,
    timeSince = function (e) {
      "object" !== typeof e && (e = new Date(e));
      var n,
        t = Math.floor((new Date() - e) / 1e3),
        o = Math.floor(t / 31536e3);
      return (
        o >= 1
          ? (n = "year")
          : (o = Math.floor(t / 2592e3)) >= 1
          ? (n = "month")
          : (o = Math.floor(t / 86400)) >= 1
          ? (n = "day")
          : (o = Math.floor(t / 3600)) >= 1
          ? (n = "hour")
          : (o = Math.floor(t / 60)) >= 1
          ? (n = "minute")
          : ((o = t), (n = "second")),
        (o > 1 || 0 === o) && (n += "s"),
        o <= 0 ? "just now" : o + " " + n + " ago"
      );
    },
    isDev = !1;
  function scrollIntoViewIfOutOfView(e) {
    if (isMobile) {
      var n =
          window.pageYOffset ||
          document.documentElement.scrollTop ||
          window.scrollY,
        t =
          window.innerHeight / 2 ||
          document.documentElement.clientHeight / 2 ||
          document.body.clientHeight / 2,
        o = 0,
        l = 0;
      if (document.layers) (o = e.y), (l = e.height);
      else {
        for (var a = e; a && "BODY" != a.tagName; a = a.offsetParent)
          o += a.offsetTop;
        l = e.offsetHeight;
      }
      (n + t < o + l || o < n) &&
        window.scrollTo({ top: o + l - t / 1.5, behavior: "smooth" });
    }
  }
  var isMobile = mobileCheck(),
    ignoreScrollEvents = !1,
    sendMessage = function (e) {
      (e.path = window.accessCodePath),
        window.ReactNativeWebView
          ? window.ReactNativeWebView.postMessage(JSON.stringify(e))
          : document.ReactNativeWebView
          ? document.ReactNativeWebView.postMessage(JSON.stringify(e))
          : window.parent.postMessage(e, "*");
    };
  function getWorkerURL(e) {
    const n = `importScripts( "${e}" );`;
    return URL.createObjectURL(new Blob([n], { type: "text/javascript" }));
  }
  var throttle = (e, n, t = { leading: !0, trailing: !0 }) => {
    let o = null,
      l = null,
      a = null;
    return function (...i) {
      if (null !== o) return (l = this), void (a = i);
      !1 !== t.leading ? e.call(this, ...i) : ((l = this), (a = i));
      const s = () => {
        !1 !== t.trailing && null !== a
          ? (e.call(l, ...a),
            (l = null),
            (a = null),
            (o = setTimeout(s, n)))
          : (o = null);
      };
      o = setTimeout(s, n);
    };
  };
  function debounce(e, n, t = { leading: !1, trailing: !0 }) {
    let o = null,
      l = null;
    return t.leading || t.trailing
      ? function (...a) {
          !o && t.leading ? e.apply(this, a) : (l = a),
            clearTimeout(o),
            (o = setTimeout(() => {
              t.trailing && l && e.apply(this, l), (l = null), (o = null);
            }, n));
        }
      : () => null;
  }
  var sendScrollPos = function () {
      var e = window.scrollY,
        n = document.body.scrollHeight;
      sendMessage({
        action: "scrollPos",
        payload: {
          isPlayerScroll:
            null != ignoreScrollEvents && 0 != ignoreScrollEvents,
          scrollTop: e,
          isActiveLineVisible:
            activePlayingLineOffset > e &&
            activePlayingLineOffset < e + window.innerHeight,
          scrollHeight: n,
        },
      }),
        (lastScrollPos = e);
    },
    sendUpdateComment = function (e, n) {
      sendMessage({
        action: "updateComment",
        payload: { commentId: e, comment: n },
      });
    };
  sendMessage({
    action: "meta",
    payload: {
      firebaseCode: document
        .querySelector("meta[name='firebaseCode']")
        .getAttribute("content"),
      branchId: document
        .querySelector("meta[name='branchId']")
        .getAttribute("content"),
    },
  });
  var sendFrequentScrollUpdates = throttle(sendScrollPos, 0, {
      leading: !0,
      trailing: !0,
    }),
    sendInFrequentScrollUpdates = throttle(sendScrollPos, 500, {
      leading: !0,
      trailing: !0,
    }),
    keyDownListener = function (e) {
      27 === e.keyCode &&
        toggleLineFocus(null, null, function () {
          sendMessage({ action: "hideComment" });
        });
    };
  window.onload = function () {
    document.addEventListener("keydown", keyDownListener),
      document.addEventListener("scroll", sendInFrequentScrollUpdates),
      document.addEventListener("click", function (e) {
        toggleLineFocus(
          e,
          function (e, n) {
            var t, o, l;
            scrollIntoViewIfOutOfView(e),
              (t = e.dataset.lineId
                ? e.dataset.lineId.split("_")[1]
                : e.id.split("_")[1]),
              e.dataset.branchId && (o = e.dataset.branchId),
              e.dataset.linePageNum && (l = e.dataset.linePageNum);
            var a = e.getBoundingClientRect();
            document.removeEventListener(
              "scroll",
              sendInFrequentScrollUpdates
            ),
              document.addEventListener(
                "scroll",
                sendFrequentScrollUpdates
              );
            var i = {
              action: "comment",
              payload: {
                lineId: t,
                lineIndex: n,
                branchId: o,
                lineText: e.innerText,
                linePageNum: l,
              },
              coords: {
                x: a.left,
                y: a.bottom,
                height: a.height,
                width: a.width,
                scrollPos: window.scrollY,
              },
            };
            sendMessage(i);
          },
          function () {
            document.removeEventListener(
              "scroll",
              sendFrequentScrollUpdates
            ),
              document.addEventListener(
                "scroll",
                sendInFrequentScrollUpdates
              ),
              sendMessage({ action: "hideComment" });
          }
        );
      });
  };
  var commentIndex = {},
    lineCommentCount = {},
    updateComment = function (e) {
      if (commentIndex[e.commentId]) {
        var n = document.getElementById(e.commentId),
          t = n.nextSibling;
        updateCommentText(e, n, t);
      } else addComment(e);
    },
    updateCommentText = function (e, n, t) {
      n.innerText = e.text;
      var o =
        "<span>" +
        e.displayName +
        ", " +
        timeSince(e.timestamp) +
        "</span>";
      e.userCanDelete &&
        (o +=
          '<span class="comment-button">' +
          (e.resolved ? "Unresolve" : "Resolve") +
          "</span>"),
        (t.innerHTML = o),
        e.userCanDelete &&
          t
            .querySelector(".comment-button")
            .addEventListener("click", (n) => {
              sendUpdateComment(e.commentId, { resolved: !e.resolved });
            });
    },
    updateCommentsToggleNodeCount = function (e) {
      var n = lineCommentCount[e],
        t = document.getElementById("toggleComentsButton_" + e);
      t && (t.querySelector(".count").innerHTML = n);
    },
    toggleComments = function (e, n, t, o) {
      var l = document.querySelectorAll(`[data-line-id$=_${e}]`)[n],
        a = l.nextElementSibling.querySelector(
          ".line-comments-inner-container"
        );
      if (a) {
        var i = (a.classList.contains("comments-hidden") && 0 != o) || o,
          s = l.nextSibling.querySelector(".line-comments-toggle-button");
        if (i) {
          a.classList.remove("comments-hidden"),
            (s.querySelector(".toggle-icon").innerHTML = "[-]");
          var d = document.querySelectorAll(".comment-highlighted");
          d && d.forEach((e) => e.classList.remove("comment-highlighted")),
            document.getElementById(t) &&
              document
                .getElementById(t)
                .classList.add("comment-highlighted");
        } else
          a.classList.add("comments-hidden"),
            (s.querySelector(".toggle-icon").innerHTML = "[+]");
      }
    },
    addComment = function (e, n) {
      var t = e.lineId,
        o = e.lineIndex || 0;
      console.log("add comment at index", o);
      var l = document.createElement("div"),
        a = document.createElement("div"),
        i = document.createElement("div");
      if (
        ((a.id = e.commentId),
        updateCommentText(e, a, i),
        (l.className = "comment-container"),
        (i.className = "comment-footer"),
        (a.className = "comment"),
        e.commentColor &&
          (a.style.cssText =
            "background-color: " +
            e.commentColor.background +
            "!important; border-color: " +
            e.commentColor.border +
            "!important;"),
        n)
      ) {
        var s = document.createElement("div");
        (s.className = "loader"), (s.id = "loader_" + t), l.appendChild(s);
      }
      var d = document.querySelectorAll(`[data-line-id$=_${t}]`)[o];
      d || (d = document.querySelector(`[id$=_${t}]`));
      var c = d.nextElementSibling.querySelector(
        ".line-comments-inner-container"
      );
      console.log("line comments inner container", c),
        c ||
          ((c = document.createElement("div")),
          (lineCommentsToggleNode = document.createElement("div")),
          (lineCommentsToggleNode.id = "toggleComentsButton_" + t),
          (lineCommentsToggleNode.innerHTML =
            '<span class="count">3</span> Comments <span class="toggle-icon">[+]</span>'),
          (lineCommentsToggleNode.className =
            "line-comments-toggle-button"),
          lineCommentsToggleNode.addEventListener("click", (e) => {
            toggleComments(t, o);
          }),
          (lineCommentsContainerNode = document.createElement("div")),
          lineCommentsContainerNode.appendChild(lineCommentsToggleNode),
          (lineCommentsContainerNode.id = "commentsContainer_" + t),
          (lineCommentsContainerNode.className = "line-comments-container"),
          (c.id = "commentsInnerContainer_" + t),
          (c.dataset.commentsInnerContainerLineId = t),
          (c.className = "line-comments-inner-container comments-hidden"),
          lineCommentsContainerNode.appendChild(c),
          d &&
            (d.classList.contains("column_1") ||
            d.classList.contains("column_2")
              ? d.appendChild(lineCommentsContainerNode)
              : d.parentNode.insertBefore(
                  lineCommentsContainerNode,
                  d.nextSibling
                ))),
        d &&
          !commentIndex[e.commentId] &&
          (c.appendChild(l),
          (commentIndex[e.commentId] = !0),
          (lineCommentCount[t] = (lineCommentCount[t] || 0) + 1),
          updateCommentsToggleNodeCount(t)),
        l.appendChild(a),
        l.appendChild(i);
    };
  setLineActive = function (e) {
    activePlayingLineId = e;
    var n = document.querySelectorAll(`[data-line-id$="_${e}"]`);
    if (n.length) {
      var t = n[0];
      activePlayingLineOffset = t.offsetTop + t.parentElement.offsetTop;
    }
  };
  var setLinePlaying = function (e, n, t) {
      activePlayingLineId = e;
      var o = document.querySelectorAll(".line_playing");
      o &&
        (o.forEach(function (e) {
          e.classList.remove("line_playing");
        }),
        t && t());
      var l = document.querySelectorAll(`[data-line-id$="_${e}"]`);
      [].forEach.call(l, function (e) {
        e &&
          (e.classList.contains("edit_lines") ||
            e.parent.classList.contains("edit_lines")) &&
          (e.classList.add("line_playing"), n && n(e));
      });
    },
    toggleLineFocus = function (e, n, t) {
      var o = document.querySelector(".line_focused"),
        l = document.getElementById("content_wrapper");
      if (!e || o)
        l.classList.remove("fade_text"),
          o &&
            (o.closest(".pdf_page").classList.remove("page_focused"),
            o.classList.remove("line_focused")),
          t && t();
      else {
        var a = null;
        if (
          (e.target.classList.contains("edit_lines")
            ? (a = e.target)
            : e.target.parentElement &&
              e.target.parentElement.classList.contains("edit_lines") &&
              (a = e.target.parentElement),
          a &&
            (a.classList.contains("edit_lines") ||
              a.parent.classList.contains("edit_lines")))
        ) {
          a.classList.add("line_focused"),
            a.closest(".pdf_page").classList.add("page_focused"),
            l.classList.add("fade_text");
          var i = a.dataset.lineId.split("_")[1],
            s = document.querySelectorAll(`[data-line-id$=_${i}]`),
            d = Array.prototype.indexOf.call(s, a);
          n && n(a, Math.max(0, d));
        }
      }
    },
    addComments = [];
  function isScrolledIntoView(e) {
    var n = e.getBoundingClientRect(),
      t = n.top,
      o = n.bottom;
    return t >= 0 && o <= window.innerHeight;
  }
  (DOMContentLoaded = (function () {
    var e,
      n,
      t = new Promise((t, o) => {
        (e = t), (n = o);
      });
    return (t.resolve = e), (t.reject = n), t;
  })()),
    "loading" !== document.readyState
      ? DOMContentLoaded.resolve()
      : window.addEventListener("DOMContentLoaded", (e) => {
          DOMContentLoaded.resolve();
        }),
    sendMessage({ action: "documentStatus", payload: { isReady: !0 } }),
    window.addEventListener(
      "message",
      (e) => {
        var n = e.data;
        if (n)
          switch (n.action) {
            case "scrollToPos":
              (scrollToPos = n.payload),
                console.log("parent wants to scroll to", scrollToPos),
                DOMContentLoaded.then(function () {
                  scrollDoc(scrollToPos);
                });
              break;
            case "scrollTo":
              var t = n.payload.id,
                o = n.payload.commentId,
                l = n.payload.lineIndex,
                a = n.payload.isPlayerScroll,
                i = n.payload.forceScroll,
                s =
                  null == n.payload.showComments || n.payload.showComments,
                d = n.payload.lineActionsVisible,
                c = n.payload.alignment || "center",
                r = n.payload.highlightOnScroll;
              s && toggleComments(t, l, o, !0),
                (m = o
                  ? document.getElementById(o)
                  : document.querySelector(`[id$="${t}"]`)) &&
                  ((!i && isScrolledIntoView(m)) ||
                    (d
                      ? sendMessage({
                          action: "setSyncScrolling",
                          payload: { enabled: !1 },
                        })
                      : (m.scrollIntoView({ behavior: "smooth", block: c }),
                        r &&
                          (document
                            .querySelectorAll(".highlight_on_scroll")
                            .forEach(function (e) {
                              e.classList.remove("highlight_on_scroll");
                            }),
                          m.classList.add("highlight_on_scroll")),
                        a
                          ? (ignoreScrollEvents &&
                              clearTimeout(ignoreScrollEvents),
                            (ignoreScrollEvents = setTimeout(() => {
                              ignoreScrollEvents = null;
                            }, 1e3)))
                          : o && clearTimeout(ignoreScrollEvents))));
              break;
            case "toggleComments":
              (t = n.payload.id), (l = n.payload.lineIndex || 0);
              var m = document.querySelector(`[id$="${t}"]`);
              toggleComments(t, l, null, !0);
              break;
            case "removeStyle":
              t = n.payload.id;
              (u = document.getElementById(t)) &&
                u.parentNode.removeChild(u);
              break;
            case "addStyle":
              var u,
                g = n.payload.css,
                p = ((t = n.payload.id), document.head),
                v = document.getElementById(t);
              v && v.parentNode.removeChild(v),
                ((u = document.createElement("style")).id = t),
                p.appendChild(u),
                u.styleSheet
                  ? (u.styleSheet.cssText = g)
                  : u.appendChild(document.createTextNode(g));
              break;
            case "setActiveLine":
              var h = n.payload.id;
              // setLineActive(h);
              break;
            case "setPlaying":
              h = n.payload.id;
              setLinePlaying(h);
              break;
            case "hideComment":
              document.removeEventListener(
                "scroll",
                sendFrequentScrollUpdates
              ),
                document.addEventListener(
                  "scroll",
                  sendInFrequentScrollUpdates
                ),
                toggleLineFocus(null, null, function () {
                  sendMessage({
                    action: "hideComment",
                    payload: {
                      shouldResetCommentText:
                        (n.payload && n.payload.shouldResetCommentText) ||
                        !1,
                    },
                  });
                });
              break;
            case "confirmedComments":
              (f = n.payload) &&
                f.forEach((e) => {
                  if (e) {
                    var n = e.lineId,
                      t = document.getElementById("loader_" + n);
                    t && t.parentNode.removeChild(t);
                  }
                });
              break;
            case "updateComments":
              (f = n.payload) &&
                DOMContentLoaded.then(function () {
                  f.forEach((e) => {
                    updateComment(e);
                  });
                });
              break;
            case "removeComments":
              (f = n.payload) &&
                f.forEach((e) => {
                  if (e) {
                    var n = (document.getElementById(e.commentId) || {})
                      .parentNode;
                    if (n) {
                      var t = n.parentNode;
                      if ((t.removeChild(n), !t.children.length)) {
                        var o = t.parentNode;
                        o.parentNode.removeChild(o);
                      }
                    }
                    delete commentIndex[e.commentId],
                      lineCommentCount[e.lineId]--,
                      updateCommentsToggleNodeCount(e.lineId);
                  }
                });
              break;
            case "addComments":
              var f;
              (f = n.payload) &&
                DOMContentLoaded.then(function () {
                  f.forEach((e) => {
                    addComment(e, n.pending);
                  });
                });
          }
      },
      !1
    );
</script>
