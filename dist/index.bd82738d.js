var t=class{constructor(t){this.canvas=t,this.context=t.getContext("2d"),this.canvas.width=this.canvasWidth(),this.canvas.height=this.canvasHeight();let s,i=!1;window.addEventListener("resize",(t=>{i?(clearTimeout(s),s=setTimeout((()=>{i=!1,this.resize(this.canvasWidth(),this.canvasHeight())}),100)):i=!0}))}clear(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}canvasWidth(){return window.innerWidth}canvasHeight(){return window.innerHeight}resize(t,s){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}};var s=class{constructor(){this.touchElement=document.getElementById("touch-surface")}onStart(t){for(const s of["touchstart","mousedown"])this.touchElement.addEventListener(s,t)}onMove(t){for(const s of["touchmove","mousemove"])this.touchElement.addEventListener(s,t)}onEnd(t){for(const s of["touchend","mouseup"])this.touchElement.addEventListener(s,t)}doOverlap(t,s,i,e){return t.x!=s.x&&t.y!=s.y&&i.x!=e.x&&i.y!=e.y&&(!(t.x>=e.x||i.x>=s.x)&&!(s.y<=i.y+10||e.y<=t.y+10))}};class i{draw(){const{x:t,y:s,w:i,h:e}=this;this.context.beginPath(),this.context.rect(t,s,i,e),this.context.lineWidth=10,this.context.stroke(),this.context.fillStyle="tan",this.context.fill(),this.context.closePath(),this.context.font="26px serif",this.context.fillStyle="black",this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText(this.number.toString(),t+i/2,s+e/2),this.context.font="20px sans-serif",this.context.fillStyle="hotpink",this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText(this.contains.toString(),t+i/2,s-15)}update(){}constructor(t,s,i,e,n){this.w=40,this.h=40,this.x=e,this.y=n,this.number=s,this.contains=i,this.context=t}}class e{constructor(t,s){this.w=30,this.h=30,this.x=0,this.y=300,this.state="searching",this.count=0,this.simulation=s,this.randomNumbers=s.shuffledNumbers(),this.target="loop"===s.mode?t:this.randomNumbers[0],console.log(this.target),this.number=t}draw(){let t=this.simulation.layers[1].context,s=this.simulation.layers[0].context;const{x:i,y:e,w:n,h:h}=this;this.target!==this.number&&(s.beginPath(),s.arc(i,e,n/3,0,2*Math.PI),s.fillStyle="rgba(0,0,255,.01)",s.fill()),s.closePath(),t.beginPath(),t.arc(i,e,n/2,0,2*Math.PI),t.lineWidth=10,t.stroke(),t.fillStyle="searching"===this.state?"yellow":"success"===this.state?"limegreen":"red",t.fill(),t.closePath(),t.font="30px serif",t.fillStyle="black",t.textAlign="center",t.textBaseline="middle",t.fillText(this.number.toString(),i,e)}update(){let t=this.simulation.step;if("success"!==this.state&&"failed"!==this.state||null===this.target||(this.x<1e3+this.number%this.simulation.columns*40&&(this.x+=t),this.y<100+40*Math.floor(this.number/this.simulation.rows)&&(this.y+=t),this.y>100+40*Math.floor(this.number/this.simulation.rows)&&(this.y-=t)),"searching"===this.state&&null!==this.target){let s=this.simulation.boxes[this.target];if(s.x===this.x&&s.y===this.y&&(this.count+=1,s.contains===this.number&&(this.state="success"),this.count>this.simulation.rows*this.simulation.columns/2&&(this.state="failed"),this.randomNumbers.splice(this.randomNumbers.indexOf(this.target),1),"loop"===this.simulation.mode?this.target=s.contains:this.target=this.randomNumbers[0]),s.x>this.x)return void(this.x+=t);if(s.x<this.x)return void(this.x-=t);if(s.y>this.y)return void(this.y+=t);if(s.y<this.y)return void(this.y-=t)}}}class n{constructor(t,s,e,n){this.prisoners=[],this.speed=5,this.shuttingDown=!1,this.selected=-1,this.selectedOffset={x:0,y:0},this.step=4,this.mode="loop",this.rows=e,this.columns=n,this.layers=t,this.touchSurface=s;const o=Array.from(Array(this.rows*this.columns)).map(((t,s)=>s)),a=h([...o]);this.boxes=o.map(((t,s)=>{let e=s%this.columns,n=Math.floor(s/this.rows);return new i(this.layers[1].context,s,a[s],500+80*e,140+80*n)})),s.onStart((t=>{let s,i;s=t.pageX,i=t.pageY,this.selected=this.boxes.findIndex((t=>s>t.x&&s<t.x+t.w&&i>t.y&&i<t.y+t.h));let e=this.boxes[this.selected];-1!==this.selected&&(this.selectedOffset={x:s-e.x,y:i-e.y})})),s.onEnd((t=>{this.selected=-1})),s.onMove((t=>{if(-1!==this.selected){let s,i;s=t.pageX-this.selectedOffset.x,i=t.pageY-this.selectedOffset.y,this.boxes[this.selected].x=4*Math.ceil(s/this.step),this.boxes[this.selected].y=4*Math.ceil(i/this.step)}})),this.main()}shuffledNumbers(){return h([...Array.from(Array(this.rows*this.columns)).map(((t,s)=>s))])}addPrisoner(){this.prisoners.length<this.boxes.length&&this.prisoners.push(new e(this.prisoners.length,this))}main(){this.tick()}tick(){if(!this.shuttingDown){let t=[...this.boxes,...this.prisoners];t.forEach((t=>{t.update()})),this.layers[1].clear(),t.forEach((t=>{t.draw()})),setTimeout((()=>{this.tick()}),this.speed)}}}function h(t){for(let s=t.length-1;s>0;s--){const i=Math.floor(Math.random()*(s+1));[t[s],t[i]]=[t[i],t[s]]}return t}new class{reset(){this.simulation=new n(this.layers,this.touchSurface,this.rows,this.columns),this.layers[0].clear(),this.resetButtons()}assignButton(t,s){this[s]=document.getElementById(t)}constructor(){this.rows=6,this.columns=6,this.layers=[new t(document.getElementById("canvas-0")),new t(document.getElementById("canvas-1"))],this.touchSurface=new s,this.assignButton("addPrisonerButton","addPrisoner"),this.assignButton("resetPrisonersButton","resetPrisoners"),this.assignButton("newGameButton","newGame"),this.assignButton("slowButton","slowButton"),this.assignButton("fastButton","fastButton"),this.assignButton("loopButton","loopButton"),this.assignButton("randomButton","randomButton"),this.reset(),this.loopButton.addEventListener("click",(()=>{this.simulation.mode="loop",this.resetButtons()})),this.randomButton.addEventListener("click",(()=>{this.simulation.mode="random",this.resetButtons()})),this.slowButton.addEventListener("click",(()=>{this.simulation.speed=20,this.resetButtons()})),this.fastButton.addEventListener("click",(()=>{this.simulation.speed=5,this.resetButtons()})),this.resetPrisoners.addEventListener("click",(()=>{this.layers[0].clear(),this.simulation.prisoners=[],this.addPrisoner.innerText=`Add Prisoner (${this.simulation.prisoners.length}/${this.simulation.boxes.length})`})),this.addPrisoner.addEventListener("click",(()=>{this.simulation.addPrisoner(),this.addPrisoner.innerText=`Add Prisoner (${this.simulation.prisoners.length}/${this.simulation.boxes.length})`})),this.newGame.addEventListener("click",(()=>{this.simulation.shuttingDown=!0,this.reset()}))}resetButtons(){this.addPrisoner.innerText=`Add Prisoner (${this.simulation.prisoners.length}/${this.simulation.boxes.length})`,"loop"===this.simulation.mode?(this.loopButton.className="active",this.randomButton.className="inactive"):(this.loopButton.className="inactive",this.randomButton.className="active"),5===this.simulation.speed?(this.slowButton.className="inactive",this.fastButton.className="active"):(this.slowButton.className="active",this.fastButton.className="inactive")}};
//# sourceMappingURL=index.bd82738d.js.map
